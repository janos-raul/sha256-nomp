<style>
    /* Stats Page Specific Styles */
    .stats-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
    }

    /* Chart Wrappers */
    .chart-wrapper {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }

    .chart-wrapper::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--gradient);
    }

    .chart-label {
        font-size: 1.3rem;
        font-weight: 600;
        text-align: center;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }

    .chart-holder {
        position: relative;
        height: 300px;
        padding: 1rem;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    /* Stat Cards */
    .stat-card {
        background: var(--bg-card);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid var(--border);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        border-color: var(--accent);
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--gradient);
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border);
    }

    .stat-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .stat-icon {
        width: 40px;
        height: 40px;
        background: rgba(59, 130, 246, 0.1);
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent);
        font-size: 1.2rem;
    }

    .stat-list {
        display: grid;
        gap: 0.75rem;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        color: var(--text-secondary);
        font-size: 0.95rem;
    }

    .stat-item i {
        color: var(--text-muted);
        margin-right: 0.5rem;
        width: 20px;
        text-align: center;
    }

    .stat-value {
        font-weight: 600;
        color: var(--text-primary);
        font-family: 'Courier New', monospace;
    }

    /* Blocks Section */
    .blocks-section {
        background: var(--bg-card);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border);
    }

    .blocks-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border);
    }

    .blocks-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .blocks-stats {
        display: flex;
        gap: 2rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .blocks-stats span {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .blocks-stats strong {
        color: var(--text-primary);
    }

    /* Block Items */
    .block-item {
        background: var(--bg-secondary);
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid;
        transition: all 0.3s ease;
        position: relative;
    }

    .block-item.pool-block {
        border-left-color: var(--success);
    }

    .block-item.solo-block {
        border-left-color: var(--warning);
        background: rgba(245, 158, 11, 0.05);
    }

    .block-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .block-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .block-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .block-height {
        font-weight: 600;
        color: var(--text-primary);
    }

    .block-height a {
        color: var(--accent);
        text-decoration: none;
    }

    .block-height a:hover {
        text-decoration: underline;
    }

    .block-type {
        display: inline-block;
        padding: 0.2rem 0.6rem;
        border-radius: 0.3rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .block-type.pool {
        background: var(--success);
        color: white;
    }

    .block-type.solo {
        background: var(--warning);
        color: white;
    }

    .block-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }

    .block-status.pending {
        color: var(--warning);
    }

    .block-status.confirmed {
        color: var(--success);
    }

    .block-status.paid {
        color: var(--accent);
    }

    .block-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .block-detail {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .block-detail i {
        color: var(--text-muted);
        width: 20px;
    }

    .block-detail a {
        color: var(--accent);
        text-decoration: none;
    }

    .block-detail a:hover {
        text-decoration: underline;
    }

    /* Pie Chart Section */
    .pie-chart-section {
        background: var(--bg-card);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border);
    }

    .pie-chart-holder {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 400px;
        position: relative;
    }

    /* Luck Indicator */
    .luck-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.25rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .luck-good {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .luck-normal {
        background: rgba(59, 130, 246, 0.1);
        color: var(--accent);
    }

    .luck-bad {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
    }

    /* Loading Animation */
    .stats-loading {
        text-align: center;
        padding: 3rem;
        color: var(--text-secondary);
    }

    .stats-loading i {
        font-size: 3rem;
        animation: spin 1s linear infinite;
        color: var(--accent);
        margin-bottom: 1rem;
        display: block;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Tablet Responsive */
    @media (max-width: 1024px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        /* Stats container mobile adjustments */
        .stats-container {
            max-width: 100%;
            overflow-x: hidden;
            padding: 1rem;
            margin: 0;
        }
        
        /* Ensure all card elements don't overflow */
        .stat-card, 
        .chart-wrapper,
        .blocks-section,
        .pie-chart-section {
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Fix chart containers */
        .chart-holder {
            max-width: 100%;
            overflow: hidden;
        }
        
        /* Mobile adjustments for blocks */
        .blocks-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .blocks-stats {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .block-details {
            grid-template-columns: 1fr;
        }
        
        /* Pie chart mobile adjustments */
        .pie-chart-holder {
            min-height: 300px;
        }
    }

    /* Very small screens */
    @media (max-width: 360px) {
        .stats-container {
            padding: 0.5rem;
        }
        
        .stat-card,
        .chart-wrapper,
        .blocks-section,
        .pie-chart-section {
            padding: 1rem;
        }
        
        .stat-title {
            font-size: 1rem;
        }
        
        .chart-label,
        .blocks-title {
            font-size: 1.1rem;
        }
    }
</style>

{{ function capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)} }}
{{ function readableDate(a) {
    var d = new Date(parseInt(a));
    return d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
} }}

<div class="stats-container">
    <!-- Charts Section -->
    <div class="chart-wrapper">
        <div class="chart-label">
            <i class="fas fa-chart-line"></i> Pool Historical Hashrate
        </div>
        <div class="chart-holder">
            <canvas id="poolHashrateChart"></canvas>
        </div>
    </div>

    <div class="chart-wrapper">
        <div class="chart-label">
            <i class="fas fa-cubes"></i> Pending Blocks (Pool + Solo)
        </div>
        <div class="chart-holder">
            <canvas id="poolPendingChart"></canvas>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        {{ for(var pool in it.stats.pools) { }}
        <!-- Pool Stats Card -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">{{=capitalizeFirstLetter(pool)}} Pool</div>
                <div class="stat-icon">
                    <i class="fas fa-server"></i>
                </div>
            </div>
            <div class="stat-list">
                <div class="stat-item">
                    <span><i class="fas fa-users"></i> Miners</span>
                    <span class="stat-value" id="statsMiners{{=pool}}">{{=it.stats.pools[pool].minerCount}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-microchip"></i> Workers</span>
                    <span class="stat-value" id="statsWorkers{{=pool}}">{{=it.stats.pools[pool].workerCount}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-tachometer-alt"></i> Hashrate</span>
                    <span class="stat-value" id="statsHashrate{{=pool}}">{{=it.stats.pools[pool].hashrateString}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-gauge"></i> Average</span>
                    <span class="stat-value" id="statsHashrateAvg{{=pool}}">...</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-clock"></i> Luck</span>
                    <span class="stat-value luck-indicator" id="statsLuckDays{{=pool}}">
                        {{ 
                        var rawLuck = it.stats.pools[pool].luckDays || 0;
                        var luck = parseFloat(rawLuck);
                        var timeUnits = [ ' Days', ' Hours', ' Minutes' ];
                        var _luckTime = 'N/A';
                        if (!isNaN(luck)) {
                            if (luck < 1) { 
                                luck *= 24; 
                                if (luck < 1) { 
                                    luck *= 60; 
                                    _luckTime = luck < 0.01 ? '< 1 Minute' : luck.toFixed(2) + timeUnits[2]; 
                                } else { 
                                    _luckTime = luck.toFixed(2) + timeUnits[1]; 
                                } 
                            } else { 
                                _luckTime = luck.toFixed(2) + timeUnits[0]; 
                            }
                        }
                        }}
                        {{= _luckTime }}
                    </span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-percentage"></i> Pool Share</span>
                    <span class="stat-value" id="statsHashPercent{{=pool}}">
                        {{=(it.stats.pools[pool].hashrate / it.stats.pools[pool].poolStats.networkHash * 100).toFixed(5)}}%
                    </span>
                </div>
            </div>
        </div>

        <!-- Network Stats Card -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">{{=capitalizeFirstLetter(pool)}} Network</div>
                <div class="stat-icon">
                    <i class="fas fa-network-wired"></i>
                </div>
            </div>
            <div class="stat-list">
                <div class="stat-item">
                    <span><i class="fas fa-cubes"></i> Height</span>
                    <span class="stat-value" id="statsNetworkBlocks{{=pool}}">{{=it.stats.pools[pool].poolStats.networkBlocks}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-tachometer-alt"></i> Network</span>
                    <span class="stat-value" id="statsnetworkHash{{=pool}}">{{=it.stats.pools[pool].poolStats.networkHashString}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-unlock"></i> Difficulty</span>
                    <span class="stat-value" id="statsNetworkDiff{{=pool}}">{{= it.getReadableDifficultyString(it.stats.pools[pool].poolStats.networkDiff) }}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-signal"></i> Connections</span>
                    <span class="stat-value" id="statsNetworkConnections{{=pool}}">{{=it.stats.pools[pool].poolStats.networkConnections}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-code-branch"></i> Version</span>
                    <span class="stat-value" id="statsNetworkVersion{{=pool}}">{{=it.stats.pools[pool].poolStats.networkVersion}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-flask"></i> Algorithm</span>
                    <span class="stat-value">{{=capitalizeFirstLetter(it.stats.pools[pool].algorithm)}}</span>
                </div>
            </div>
        </div>

        <!-- Block Stats Card -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">{{=capitalizeFirstLetter(pool)}} Blocks</div>
                <div class="stat-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
            </div>
            <div class="stat-list">
                <div class="stat-item">
                    <span><i class="fas fa-check-circle"></i> Total Valid</span>
                    <span class="stat-value">{{=it.stats.pools[pool].poolStats.validBlocks}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-hourglass-half"></i> Pool Pending</span>
                    <span class="stat-value">{{=it.stats.pools[pool].poolBlocks.pending}}</span>
                </div>
                {{ if (it.stats.pools[pool].soloBlocks) { }}
                <div class="stat-item">
                    <span><i class="fas fa-user"></i> Solo Pending</span>
                    <span class="stat-value">{{=it.stats.pools[pool].soloBlocks.pending || 0}}</span>
                </div>
                {{ } }}
                <div class="stat-item">
                    <span><i class="fas fa-check"></i> Pool Confirmed</span>
                    <span class="stat-value">{{=it.stats.pools[pool].poolBlocks.confirmed}}</span>
                </div>
                {{ if (it.stats.pools[pool].soloBlocks) { }}
                <div class="stat-item">
                    <span><i class="fas fa-user-check"></i> Solo Confirmed</span>
                    <span class="stat-value">{{=it.stats.pools[pool].soloBlocks.confirmed || 0}}</span>
                </div>
                {{ } }}
                <div class="stat-item">
                    <span><i class="fas fa-times-circle"></i> Orphaned</span>
                    <span class="stat-value">{{=it.stats.pools[pool].blocks.orphaned}}</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-money-bill"></i> Total Paid</span>
                    <span class="stat-value" id="statsTotalPaid{{=pool}}">{{=(parseFloat(it.stats.pools[pool].poolStats.totalPaid)).toFixed(8)}}</span>
                </div>
            </div>
        </div>
        {{ } }}
    </div>

    <!-- Blocks Found Section -->
    {{ for(var pool in it.stats.pools) { }}
    {{ var blockscomb = new Array; }}
    <div class="blocks-section">
        <div class="blocks-header">
            <div class="blocks-title">
                <i class="fas fa-cube"></i> {{=capitalizeFirstLetter(pool)}} Blocks Found
            </div>
            <div class="blocks-stats">
                <span>
                    <i class="fas fa-cubes"></i>
                    <strong id="statsValidBlocks{{=pool}}">
                        {{=it.stats.pools[pool].blocks.pending + it.stats.pools[pool].blocks.confirmed}}
                    </strong> Total
                </span>
                <span>
                    <i class="fas fa-server"></i>
                    Pool: <strong id="statsPoolBlocks{{=pool}}">
                        {{=it.stats.pools[pool].poolBlocks.pending + it.stats.pools[pool].poolBlocks.confirmed}}
                    </strong>
                </span>
                {{ if (it.stats.pools[pool].soloBlocks && (it.stats.pools[pool].soloBlocks.pending > 0 || it.stats.pools[pool].soloBlocks.confirmed > 0)) { }}
                <span>
                    <i class="fas fa-user"></i>
                    Solo: <strong id="statsSoloBlocks{{=pool}}">
                        {{=it.stats.pools[pool].soloBlocks.pending + it.stats.pools[pool].soloBlocks.confirmed}}
                    </strong>
                </span>
                {{ } }}
            </div>
        </div>

        <div class="blocks-list">
            <!-- Pool Pending Blocks -->
            {{ for(var b in it.stats.pools[pool].poolPending.blocks) { }}
            {{ var block = it.stats.pools[pool].poolPending.blocks[b].split(":"); }}
            <div class="block-item pool-block">
                <div class="block-main">
                    <div class="block-info">
                        <span class="block-height">
                            <i class="fas fa-cube"></i>
                            {{ if (it.poolsConfigs[pool].coin.explorer && it.poolsConfigs[pool].coin.explorer.blockURL) { }}
                            <a href="{{=it.poolsConfigs[pool].coin.explorer.blockURL + block[0]}}" target="_blank">Block #{{=block[2]}}</a>
                            {{ } else { }}
                            Block #{{=block[2]}}
                            {{ } }}
                        </span>
                        <span class="block-type pool">POOL</span>
                    </div>
                    <div class="block-status pending">
                        {{if (it.stats.pools[pool].poolPending.confirms && it.stats.pools[pool].poolPending.confirms[block[0]]) { }}
                            {{ var confirms = parseInt(it.stats.pools[pool].poolPending.confirms[block[0]]); }}
                            {{ var minConf = parseInt(it.poolsConfigs[pool].paymentProcessing.minConf); }}
                            {{ if (confirms >= minConf) { }}
                                <i class="fas fa-check-circle"></i> Confirmed
                            {{ } else { }}
                                <i class="fas fa-spinner fa-spin"></i> {{=confirms}}/{{=minConf}}
                            {{ } }}
                        {{ } else { }}
                            <i class="fas fa-clock"></i> Pending
                        {{ } }}
                    </div>
                </div>
                <div class="block-details">
                    <div class="block-detail">
                        <i class="fas fa-user"></i>
                        <span>Found by: <a href="/workers/{{=block[3].split('.')[0]}}">{{=block[3].split('.')[0]}}</a></span>
                    </div>
                    {{if (block[4] != null) { }}
                    <div class="block-detail">
                        <i class="fas fa-calendar"></i>
                        <span>{{=readableDate(block[4])}}</span>
                    </div>
                    {{ } }}
                </div>
            </div>
            {{ blockscomb.push(block);}}
            {{ } }}

            <!-- Pool Confirmed Blocks -->
            {{ var i=0; for(var b in it.stats.pools[pool].poolConfirmed.blocks) { }}
            {{ if (i < 8) { i++; }}
            {{ var block = it.stats.pools[pool].poolConfirmed.blocks[b].split(":"); }}
            <div class="block-item pool-block">
                <div class="block-main">
                    <div class="block-info">
                        <span class="block-height">
                            <i class="fas fa-cube"></i>
                            {{ if (it.poolsConfigs[pool].coin.explorer && it.poolsConfigs[pool].coin.explorer.blockURL) { }}
                            <a href="{{=it.poolsConfigs[pool].coin.explorer.blockURL + block[0]}}" target="_blank">Block #{{=block[2]}}</a>
                            {{ } else { }}
                            Block #{{=block[2]}}
                            {{ } }}
                        </span>
                        <span class="block-type pool">POOL</span>
                    </div>
                    <div class="block-status paid">
                        <i class="fas fa-check-double"></i> Paid
                    </div>
                </div>
                <div class="block-details">
                    <div class="block-detail">
                        <i class="fas fa-user"></i>
                        <span>Found by: <a href="/workers/{{=block[3].split('.')[0]}}">{{=block[3].split('.')[0]}}</a></span>
                    </div>
                    {{if (block[4] != null) { }}
                    <div class="block-detail">
                        <i class="fas fa-calendar"></i>
                        <span>{{=readableDate(block[4])}}</span>
                    </div>
                    {{ } }}
                </div>
            </div>
            {{blockscomb.push(block);}}
            {{ } }}
            {{ } }}

            <!-- Solo Pending Blocks -->
            {{ if (it.stats.pools[pool].soloPending && it.stats.pools[pool].soloPending.blocks.length > 0) { }}
            {{ for(var b in it.stats.pools[pool].soloPending.blocks) { }}
            {{ var block = it.stats.pools[pool].soloPending.blocks[b].split(":"); }}
            <div class="block-item solo-block">
                <div class="block-main">
                    <div class="block-info">
                        <span class="block-height">
                            <i class="fas fa-cube"></i>
                            {{ if (it.poolsConfigs[pool].coin.explorer && it.poolsConfigs[pool].coin.explorer.blockURL) { }}
                            <a href="{{=it.poolsConfigs[pool].coin.explorer.blockURL + block[0]}}" target="_blank">Block #{{=block[2]}}</a>
                            {{ } else { }}
                            Block #{{=block[2]}}
                            {{ } }}
                        </span>
                        <span class="block-type solo">SOLO</span>
                    </div>
                    <div class="block-status pending">
                        {{if (it.stats.pools[pool].soloPending.confirms && it.stats.pools[pool].soloPending.confirms[block[0]]) { }}
                            {{ var confirms = parseInt(it.stats.pools[pool].soloPending.confirms[block[0]]); }}
                            {{ var minConf = parseInt(it.poolsConfigs[pool].paymentProcessing.minConf); }}
                            {{ if (confirms >= minConf) { }}
                                <i class="fas fa-check-circle"></i> Confirmed
                            {{ } else { }}
                                <i class="fas fa-spinner fa-spin"></i> {{=confirms}}/{{=minConf}}
                            {{ } }}
                        {{ } else { }}
                            <i class="fas fa-clock"></i> Pending
                        {{ } }}
                    </div>
                </div>
                <div class="block-details">
                    <div class="block-detail">
                        <i class="fas fa-user"></i>
                        <span>Found by: <a href="/workers/{{=block[3].split('.')[0]}}">{{=block[3].split('.')[0]}}</a></span>
                    </div>
                    {{if (block[4] != null) { }}
                    <div class="block-detail">
                        <i class="fas fa-calendar"></i>
                        <span>{{=readableDate(block[4])}}</span>
                    </div>
                    {{ } }}
                </div>
            </div>
            {{ blockscomb.push(block);}}
            {{ } }}
            {{ } }}

            <!-- Solo Confirmed Blocks -->
            {{ if (it.stats.pools[pool].soloConfirmed && it.stats.pools[pool].soloConfirmed.blocks.length > 0) { }}
            {{ var j=0; for(var b in it.stats.pools[pool].soloConfirmed.blocks) { }}
            {{ if (j < 8) { j++; }}
            {{ var block = it.stats.pools[pool].soloConfirmed.blocks[b].split(":"); }}
            <div class="block-item solo-block">
                <div class="block-main">
                    <div class="block-info">
                        <span class="block-height">
                            <i class="fas fa-cube"></i>
                            {{ if (it.poolsConfigs[pool].coin.explorer && it.poolsConfigs[pool].coin.explorer.blockURL) { }}
                            <a href="{{=it.poolsConfigs[pool].coin.explorer.blockURL + block[0]}}" target="_blank">Block #{{=block[2]}}</a>
                            {{ } else { }}
                            Block #{{=block[2]}}
                            {{ } }}
                        </span>
                        <span class="block-type solo">SOLO</span>
                    </div>
                    <div class="block-status paid">
                        <i class="fas fa-check-double"></i> Paid
                    </div>
                </div>
                <div class="block-details">
                    <div class="block-detail">
                        <i class="fas fa-user"></i>
                        <span>Found by: <a href="/workers/{{=block[3].split('.')[0]}}">{{=block[3].split('.')[0]}}</a></span>
                    </div>
                    {{if (block[4] != null) { }}
                    <div class="block-detail">
                        <i class="fas fa-calendar"></i>
                        <span>{{=readableDate(block[4])}}</span>
                    </div>
                    {{ } }}
                </div>
            </div>
            {{blockscomb.push(block);}}
            {{ } }}
            {{ } }}
            {{ } }}
        </div>
    </div>

    <!-- Pie Chart for Block Finders -->
    {{ if (blockscomb.length > 0) { }}
    <div class="pie-chart-section">
        <div class="chart-label">
            <i class="fas fa-chart-pie"></i> Top 10 Miners - Last {{=blockscomb.length}} Blocks
        </div>
        <div class="pie-chart-holder">
            <canvas id="blocksPie{{=pool}}"></canvas>
        </div>
    </div>
    
    <script>
        var blockscomb{{=pool}} = {{=JSON.stringify(blockscomb)}};
    </script>
    {{ } }}
    {{ } }}
</div>

<script src="/static/modern-stats.js"></script>
<script>
(function() {
    function initStatsPage() {
        // Prevent multiple initializations
        if (window.statsPageFullyInitialized) {
            console.log('Stats page already initialized');
            return;
        }
        window.statsPageFullyInitialized = true;
        
        console.log('Initializing stats page...');
        
        // Fix mobile header
        const header = document.querySelector('.header');
        if (header) {
            header.style.position = 'fixed';
            header.style.top = '0';
            header.style.left = '0';
            header.style.right = '0';
            header.style.width = '100%';
            header.style.zIndex = '1000';
        }
        
        // Ensure body padding for fixed header
        document.body.style.paddingTop = '70px';
        
        // Mobile menu functionality
        if (!window.toggleMenu) {
            window.toggleMenu = function() {
                const nav = document.getElementById('nav');
                if (nav) {
                    nav.classList.toggle('active');
                    document.body.classList.toggle('menu-open');
                }
            };
        }
        
        // Ensure menu toggle is visible and works
        const menuToggle = document.querySelector('.menu-toggle');
        if (menuToggle) {
            // Make sure it's visible on mobile
            menuToggle.style.display = '';
            
            // Clear existing handlers
            const newToggle = menuToggle.cloneNode(true);
            menuToggle.parentNode.replaceChild(newToggle, menuToggle);
            
            // Add click handler
            newToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                window.toggleMenu();
            });
        }
        
        // Initialize charts only once
        if (typeof window.initStatsCharts === 'function') {
            // Reset the pool stats initialization flag
            window.poolStatsInitialized = false;
            window.initStatsCharts();
        }
    }
    
    // Register for hot-swap
    window.initStatsScripts = function() {
        window.statsPageFullyInitialized = false;
        initStatsPage();
    };
    
    // Initialize on DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initStatsPage);
    } else {
        initStatsPage();
    }
})();
</script>